{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2014-10-19-systemd-nice-dont-afraid/","result":{"data":{"site":{"siteMetadata":{"title":"Lambdacurry"}},"markdownRemark":{"id":"d5da8023-1ebd-5ea6-86a5-96cc84184181","excerpt":"The “WMD” argument Most of the arguments against systemd are up-in-the-air, monsters-under-the-bed variety. Sound familiar ? When a noisy minority takes the…","html":"<h1>The “WMD” argument</h1>\n<p>Most of the arguments against systemd are up-in-the-air, monsters-under-the-bed variety. Sound familiar ?</p>\n<p>When a noisy minority takes the help of social media and makes a lot of noise of “how Linux is being destroyed by Lennart”, it sounds all too familiar.</p>\n<h1>What is the Unix way ?</h1>\n<p>What is the Unix way ? Is Mac OSX the Unix way ? _launchd _- the init system for OSX behaves very similarly to systemd.</p>\n<p>Some people say that the unix way is to not have too many functionality in one binary. In fact a popular statment that I have heard is ”<em>To Lennart - In Unix, each program should implement only a very small, managable set of feature, whereas your projects are usually bloated with functionality</em>”. If you build systemd with all configuration options enabled you will build 69 individual binaries. So is it still non-unixy ? Where is it bloated ?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0ace4bb75b2b96c5e1dfd64b6f6fc2ee/37523/systemd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADIUlEQVQozyWKXW/aZhiG/bu2o63SVmmTerjzSjvZL5gmTZNWJZSk6QpJmjZrKZ+BJBsJwU4IAbsQG7ANwTYYfxEwEIjfho9m6SJFTd5nbndw67qv+3mIXdZm/9gUZst/152XKdl5slG58CUb9cC+aj2JFscvkqLjDb1FL3eqKJJR0RZjoQApo0ROQ29ICUUOWyiR15313drsqDZiCbVqqLl0YXy4Qzt8oXauScblZIDiN2fKCdIqs4kpOsMGi6ZWFcE/fQSXvf8567rd5Xv7kztwNRi7W5OwmgMoZGrA7ItQLxkgC23o6oPOtVm8uaztwL/NDHxoHMCNsgd98ilo249hlFmGi2IQzL88MKJfQzu1BK3EIzgvhIEwZPs2n+bxcfYEFzO1W2q7AFK5JUxL0akR+wXOqKd3dmoRv9v+GQ8XvsJnC1/jnvcenkV+xNbvX+Jp8CE+W7qPh/Nf4Fnsp1tCVtpJOs/3GUYw+JJs6tqg1+29C18OdcbReHt8Wjcv2nXrQi9bM4my3sv71kTat67aFWuq0tbVqUslY0zqVH/aOEoSBbN3vZYrwUZFxl5ahKWSileqFnjoOixyLeyvdmCxrENCP4fVky78dsCDp6jCpjaCXW0IcbkDaQvhpOmAgD5cE1xv8nEpX8NB0cQPUwL+9vUBfhBj7r4LH919H8riB5EcvrdO4l/zCv4hlsff/Eni++7PI0bB61wDz5EsDogWXsqJ+NgefyQKCkdt0uQoxWU7waO0HciRdrpRsamWYJNN3qZU3t5z/fhUsg810U67G+lubEe2+Y5kF3XBFmylwxriSOo3KIK3tpTNw/kxI71yMuUVtJX1oHongXK8H1XNGKJrayhbfoby4iri9QjKVnzubRkJRhRRFT9iWyFUaLxx3D6p93cVQlj3xZnnXoFe9bKVV8+4ZniVs7I7XJ0hOZUmuXZ+j1Pc3nxLcd1PpNOc7PbTXIqTAn5OCT/nGuE1VgquCGrwRZwQvY/J8rwHuLk5qC0sgO7zQTsUAm1jA4xoFOxYDIx4HAzXe25MN7rrnUjk86++7Afd7wfD/5nkf6B5sgmVGnpkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"/systemd.png\"\n        title=\"/systemd.png\"\n        src=\"/static/0ace4bb75b2b96c5e1dfd64b6f6fc2ee/37523/systemd.png\"\n        srcset=\"/static/0ace4bb75b2b96c5e1dfd64b6f6fc2ee/63868/systemd.png 250w,\n/static/0ace4bb75b2b96c5e1dfd64b6f6fc2ee/0b533/systemd.png 500w,\n/static/0ace4bb75b2b96c5e1dfd64b6f6fc2ee/37523/systemd.png 720w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Or is the unix way about choice - That one should be able to use whichever init system they want ? That is a fair statement and I completely empathize with it - but the question is really, who is really paying the price for this choice ?</p>\n<p>The answer is not : <em>you - the user</em>. It is:_ they - package maintainers and developers_. For example, the guy who maintains Plex on Debian will now have to maintain compatibility on multiple init systems or else… his software will not be available on Debian’s default package repository.</p>\n<h1>Shell scripts are unixy - systemd .service files are not</h1>\n<p>systemd defines <a href=\"http://www.freedesktop.org/software/systemd/man/systemd.service.html\">.service</a> files to be used to define services (start, stop, dependencies, etc.). A service file is a declarative way to define a service. Previously, this used to be achieved by shell scripts - most of which were copied from someone who made it previously. For example, <a href=\"https://github.com/gitlabhq/gitlab-recipes/blob/master/init/sysvinit/debian/gitlab-puma\">this</a> is the sysvinit startup file for gitlab. And <a href=\"https://github.com/gitlabhq/gitlab-recipes/blob/master/init/systemd/gitlab-unicorn.service\">this</a> + <a href=\"https://github.com/gitlabhq/gitlab-recipes/blob/master/init/systemd/gitlab.target\">this</a> is the same startup file implemented as a systemd service.</p>\n<p>Are shell scripts unixy ? Frankly, after <a href=\"http://en.wikipedia.org/wiki/Shellshock_%28software_bug%29\">ShellShock</a>, I really dont care for millions of shell scripts (as part of init systems) written and maintained by hundreds of people.  I would much rather prefer a config file parsed by a single program, which can be audited far, far better.</p>\n<p>There are people who are far more qualified as sysadmins than I will ever be, who have the following <a href=\"http://debianfork.org/\">opinion</a>:</p>\n<blockquote>We like controlling the startup of the system with shell scripts that are readable, because readability grants a certain level of power and consciousness for those among us who are literate</blockquote>\n<p>I respect the emotion, but cannot empathize with the result. Your freedom to possess power and consciousness ends where my productivity, security and usability begins.</p>\n<h1>systemd caused the Linux community to fragment</h1>\n<p>Atleast Upstart and SysvInit existed before systemd. There were also many others - like _initng _(for Berry Linux, etc.)</p>\n<p>Oh, and lets not forget the big one - Android and it’s init system ”<em>binder</em>“.</p>\n<h1>The Binary log file problem</h1>\n<p>Simply put - systemd is trying to pull a <a href=\"http://www.splunk.com/\">Splunk</a> on your local machine. It is trying to build an indexed binary format for your log files on your machine, so you can do … well <a href=\"http://www.splunk.com/view/product-tour/SP-CAAAAGV\">this</a>. I think Lennart envisions an ecosystem of products that can easily aggregate and mine log files, much much more simply than what Splunk or Loggly’s collectors do today.</p>\n<p>Now, this is the second of the most contentious design decisions that systemd has taken and arguably has led to a huge amount of polarisation. There have been the inevitable comparisons with Windows event viewer and how binary logs have broken every known legacy tool ever.</p>\n<p>This is true - I really, really dont know how good or bad this will be. I honestly cant see that far into the future - but I can respect the thought.</p>\n<p>Secondly, getting a text log (via <code class=\"language-text\">ForwardToSyslog</code> journal-to-syslog forwarding) is bloody simple.</p>\n<h1>The “boot without /usr ” FUD</h1>\n<p>A popular conception is that systemd killed the possibility to have a separate /usr volume. systemd itself is actually completely fine with /usr on a separate file system that is not pre-mounted at boot time - however, many other components of Linux break because of this. <a href=\"http://freedesktop.org/wiki/Software/systemd/separate-usr-is-broken/\">systemd is just the messenger.</a></p>\n<p>In fact, systemd developers are trying really hard to build <a href=\"http://0pointer.net/blog/projects/stateless.html\">stateless</a> and <a href=\"https://plus.google.com/u/3/+KaySievers/posts/UJ1Hj7DE4ZS\">minimally bootable</a> systems.</p>\n<h1>Socket Activation FUD</h1>\n<p>Here’s a comment by Russ Alberry of the Debian CTTE</p>\n<p><a href=\"https://lists.debian.org/debian-ctte/2013/12/msg00234.html\">https://lists.debian.org/debian-ctte/2013/12/msg00234.html</a></p>\n<blockquote>Socket activation, by which I don't mean lazy start of daemons, although it enables that, but init management of socket setup so that daemons can start in parallel.\n<p>This has been discussed elsewhere on the thread, but I want to note here that systemd’s approach is bold and innovative. We’ve had multiple discussions in Debian lists in the past where people have felt somewhat depressed or discouraged about Debian’s lack of innovation or unwillingness to tackle sweeping improvements. After having studied and\nimplemented socket activation, I think this is one of those opportunities, and we should not pass it by.</p>\n<p>There are a variety of advantages to socket activation that have been discussed elsewhere, and I’m not going to repeat them all here. But one\nI want to call out is the advantage for an enterprise systems administration environment. Right now, in order to configure bind addresses or IPv6 behavior for my services, I have to dig into the individual configuration syntax or command-line flags of each separate daemon, and often there’s no easy way to set these parameters without making intrusive changes to daemon startup. Socket activation lets me manage all of this through a simple configuration override that I drop into /etc via (for example) Puppet, and the syntax is the same for every\nservice that uses it. It would obviously take quite some time to get there, but that’s a really nice vision of the future, and one that would make a real difference for Debian use cases I care about.</blockquote></p>\n<p>The interesting part is that the Ubuntu competitor to Systemd -  Upstart -  also supports socket activation. Everyone is in agreement that socket activation is a particularly good idea… Just that systemd implements it <a href=\"https://lists.debian.org/debian-ctte/2013/12/msg00177.html\">particularly well</a>.</p>\n<h1>Everyone hates systemd</h1>\n<p>For an innocent bystander, systemd looks to be truly evil. Everyone seems to be hating it and only Lennart seems to be the evil mastermind promoting it.</p>\n<p>Nothing could be further from the truth. Even before systemd became the default, Spotify <a href=\"https://lists.debian.org/debian-ctte/2014/01/msg00287.html\">came out</a> in support for it</p>\n<blockquote>\n<blockquote>\n<p>Spotify, an online streaming music service, is a significant user of Debian GNU/Linux. We have some 5000 physical servers and well over a thousand virtual servers using both public and private clouds running Debian GNU/Linux serving millions of songs to our users every day.</p>\n</blockquote>\n<blockquote>\n</blockquote>\n<blockquote>\n<p>We would like to take this opportunity to endorse systemd as our preferred init system and we would like to see it as default on Debian GNU/Linux moving forward.</p>\n</blockquote>\n<blockquote>\n</blockquote>\n</blockquote>\n<h1>systemd is meaningless on the server</h1>\n<p>One of the most exciting engineering efforts in modern times - CoreOS and fleet are based on systemd. Both these Docker-based technologies are powering Google-like infrastructure for smaller startups.</p>\n<p>In addition, as I pointed out above - startups like Spotify decided to bet on systemd, even when it was not standardized.</p>\n<p>Also, as Russ Alberry quoted above, ”<em>… one</em>\n_ I want to call out is the advantage for an enterprise systems administration environment._” The sophisticated socket activation and <a href=\"http://0pointer.de/blog/projects/resources.html\">resource management abilities</a> of systemd are a godsend for building and managing large services on the cloud.</p>\n<h1>Desktop Linux is dead - why fight for it ?</h1>\n<p>This has been the most … frustrating thing that I hear from people. I have heard a million variants of “I dont care about desktop linux - just dont touch the server because of this”.</p>\n<p>This is the sad truth - in the USA and Europe, OSX has won. Every developer in every startup may deploy on Linux, but codes on the Mac.</p>\n<p>But desktop linux is being transformative in Asia. In fact, India is becoming one of the fastest growing markets for Linux. Desktop linux is critical for everything here.</p>\n<p>A good argument is <em>**mobile **</em>linux is becoming more relevant here - by which you essentially mean Android. But again, that is an argument made by people who work primarily on Macbooks and look at Linux/Android as auxiliary.</p>\n<p>This is not the case in India.</p>\n<h1>Gnome and KDE hard dependency theories - conspiracy ?</h1>\n<p>another big conspiracy theory is that Gnome and KDE are building hard dependencies on systemd. What need does a GUI desktop environment have of an init system ? Is this not definitive proof that systemd is trying to take over everything.</p>\n<p>Well, actually Gnome and KDE dont depend on systemd, but rather logind - which is incidentally powering a lot of long-waited changes in desktop security and interaction. For example, it is <a href=\"http://fedoraproject.org/wiki/Changes/XorgWithoutRootRights\">powering</a> XWindows-without-root, something that is pretty cool for desktop security. Some of the other cool things it enables on the desktop are:</p>\n<ul>\n<li><a href=\"http://dvdhrm.wordpress.com/2013/08/24/session-management-on-linux/\">http://dvdhrm.wordpress.com/2013/08/24/session-management-on…</a></li>\n<li><a href=\"http://dvdhrm.wordpress.com/2013/08/24/how-vt-switching-works/\">http://dvdhrm.wordpress.com/2013/08/24/how-vt-switching-work…</a></li>\n<li><a href=\"http://dvdhrm.wordpress.com/2013/08/25/sane-session-switching/\">http://dvdhrm.wordpress.com/2013/08/25/sane-session-switchin…</a></li>\n</ul>\n<p>Oh, but logind seems to be pretty useless on the server. Isnt this a problem of prioritizing desktop features vs a server ? Well, logind also powers featuresets like <a href=\"http://www.freedesktop.org/wiki/Software/systemd/inhibit/\">inhibitor locks</a> (<em>A package manager wants to ensure that the system is not turned off while a package upgrade is in progress</em>).</p>\n<h1>the cgroup arbiter issue</h1>\n<p>One of the other reasons that Gnome and KDE are building hard dependencies to logind is because of the cgroup arbiter issue. The Linux _kernel group _(and not systemd) is <a href=\"http://www.linuxfoundation.org/news-media/blogs/browse/2013/08/all-about-linux-kernel-cgroup%E2%80%99s-redesign\">mandating</a> that cgroups be written by a single writer in userspace.</p>\n<p>systemd <a href=\"http://www.freedesktop.org/wiki/Software/systemd/ControlGroupInterface/\">implements</a> this single writer API and therefore seems to become “all powerful”. Here’s the kicker - every init system will need to do this eventually. systemd is just being the first one to do it.</p>\n<h1>hard dependency on systemd libraries - libsystemd</h1>\n<p><a href=\"https://github.com/linuxmint/systemd/blob/master/src/libsystemd-daemon/sd-daemon.c\">libsystemd-daemon</a> is a packaging of sd<em>notify - a fairly well documented _protocol _ to communicate with systemd. This is not so much a dependency as much as a convenience. For illustration, here’s the same thing reimplemented in <a href=\"https://github.com/kirelagin/pysystemd-daemon/blob/master/sddaemon/__init__.py\">python</a> and [erlang](<a href=\"https://github.com/lemenkov/erlang-sd\">https://github.com/lemenkov/erlang-sd</a></em>notify).</p>\n<h1>systemd has trashed cron</h1>\n<p><a href=\"https://wiki.archlinux.org/index.php/Systemd/Timers\">systemd timers</a> are widely considered to be the answer to cron - that is true…but in no way does it trash cron.</p>\n<p>systemd timers have the ability to specify dependencies, are automatically logged and run jobs with resource limits (using cgroups). That in itself makes it far superior to cron.</p>\n<h1>udev is unusable without systemd (cue Lennart hate)</h1>\n<p>udev is dependent on kdbus - the high performance IPC mechanism, implemented in the kernel rather than userspace. kdbus is dependent on systemd for initialization.</p>\n<p>udev will soon drop the netlink-based transport mechanism and therefore a hard dependency on systemd will arise. Again, this is something that you can replace if you can build the initialization code.</p>\n<p>Secondly, udev is being maintained by Kay Sievers - not Lennart. This decision was a collaborative result of two core maintainers, rather than a global conspiracy. Here’s what Kay has to <a href=\"https://lwn.net/Articles/490413/\">say</a> about udev:</p>\n<blockquote>\n<blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\nToday, ‘Init’ needs to be fully hotplug-capable; udev device management and knowledge about device lifecycles is an integral part of systemd and not an isolated logic. Due to this, and to minimize our\nadministrative workload, as well as to minimize duplication of code, and to resolve cyclic build dependencies in the core OS, we have decided to merge the two projects.</code></pre></div>\n</blockquote>\n</blockquote>\n<h1> All of the above have been possible on *nix for decades</h1>\n<p>Which for me summarizes what systemd is versus what people <em>think</em> it is. More than ideas, systemd is innovation in implementation. There have been a hundred million “recipes” floating around on how to build stateless systems, or what is the ”<a href=\"http://dev.mysql.com/doc/refman/5.0/en/mysql-server.html\">best</a>” startup script for a particular service.</p>\n<p>systemd standardizes on all of that - it builds consistency where there was none. It makes it possible for someone like me to start building Google-ish clouds - by reducing the complexity by orders of magnitude. How could you not want that ?</p>\n<h1>Joey Hess did not leave because of systemd</h1>\n<p>Here’s his <a href=\"http://joeyh.name/blog/entry/a_programmable_alarm_clock_using_systemd/\">blog post</a> building a cool little hack on his laptop using systemd.</p>\n<blockquote>I don't think this would be anywhere near as easy to do without systemd, logind, etc. Especially the handling of waking the system at the right time, and the behavior around lid sleep inhibiting.</blockquote>\n<h1>Tweet  #systemdisnice</h1>","frontmatter":{"title":"systemd is nice. Dont be afraid.","date":"October 19, 2014"}}},"pageContext":{"slug":"/blog/2014-10-19-systemd-nice-dont-afraid/","previous":{"fields":{"slug":"/blog/2014-03-29-compiling-bitcoin-0-9-0-transaction-malleability-fix/"},"frontmatter":{"title":"Compiling bitcoin 0.9.0 - the transaction malleability fix"}},"next":{"fields":{"slug":"/blog/2014-11-03-the-android-art-runtime-is-a-golang-tunnel/"},"frontmatter":{"title":"The Android ART runtime is a Golang tunnel"}}}},"staticQueryHashes":["2778469899","2841359383","2882394463","3616023293"]}