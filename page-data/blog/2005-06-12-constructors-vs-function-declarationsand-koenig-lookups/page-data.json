{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2005-06-12-constructors-vs-function-declarationsand-koenig-lookups/","result":{"data":{"site":{"siteMetadata":{"title":"Lambdacurry"}},"markdownRemark":{"id":"9061c682-890a-5ac7-ab47-81146dfaf767","excerpt":"A very curious incident happened with compilation today. “but nothing happened…” That was the curious incident. Consider the piece of code below: #include…","html":"<p>A very curious incident happened with compilation today.<br>\n“but nothing happened…”</p>\n<p>That was the curious incident.</p>\n<p>Consider the piece of code below:</p>\n<p>#include <iostream>\nusing namespace std;\nclass A{\npublic:\nA() {_i=5;}\n~A(){cout&#x3C;&#x3C;“Destroying A”&#x3C;&#x3C;endl;}\nint _i;\n};\nclass B: public  A{\npublic:\nB() {}\n~B(){cout&#x3C;&#x3C;“Destroying B”&#x3C;&#x3C;endl;}</p>\n<p>};</p>\n<p>main(){\nA a( B() );\ncout&#x3C;&#x3C;a._i;\n}</p>\n<p>Now normally, I would think that everything is all right. My expected screen output is:</p>\n<p>“Destroying A”<br>\n“Destroying B”<br>\n“Destroying A” (its inherited)</p>\n<p>However, there is no screen output.<br>\nTo further investigate, let us try to access a member variable “_i” of A.<br>\nThe compiler squeals:<br>\n>>constructor.cpp: In function ‘int main()’<br>\n>>constructor.cpp: error: request for member ‘_i’ in ‘a’, which is of non-class type ‘A()(B(*)())</p>\n<p>“non-class”?? Very strange. What’s even more strange is the way that the constructor parameters to A are interpreted - as pointer to functions.</p>\n<p>Now, we know for a fact that STL uses functors, so let’s try something like this with them.</p>\n<p>#include <iostream>\n#include <vector>\n#include <algorithm>\nusing namespace std;\nclass Functor1{\npublic:\nvoid  operator ()(int i){ }\n};\nmain(){\nvector&#x3C;int> vv;</p>\n<p>for_each(vv.begin(), vv.end(), Functor1());</p>\n<p>}</p>\n<p>STL has no problem.</p>\n<p>Actually, in the first case, C++ interprets A a() as local declaration of a function ‘a’ with return type A. One of a long <a href=\"http://groups-beta.google.com/group/comp.lang.c++.moderated/browse_thread/thread/dd860b18e5c6cd23/493ade0efede15ca?q=c%2B%2B+constructor+%22function+declaration%22&#x26;rnum=2#493ade0efede15ca\">threads</a> in the “comp.lang.c++.moderated” newsgroups speaks about this dichotomy.</p>\n<p>among one of the workarounds posted is this :</p>\n<p>//A a=A( B() );</p>\n<p>Which brings us to the motivations behind programmers declaring functions in local scope. One of the possible reason is to hide an overloaded function declaration. For example, in the following example, the local function declaration overrides the global function declaration:</p>\n<p>#include <iostream></p>\n<p>void f(int i) { std::cout &#x3C;&#x3C; “int=” &#x3C;&#x3C; i &#x3C;&#x3C; ‘n’; }\nvoid f(short s) { std::cout &#x3C;&#x3C; “short=” &#x3C;&#x3C; s &#x3C;&#x3C; ‘n’;}</p>\n<p>int main()\n{\nf(1); // calls f(int)\nvoid f(short);\nf(1); // fooled you!</p>\n<p>}</p>\n<p>However this can be taken care of, by using Koenig lookup - which works only if there are namespaces or classes to be resolved (I dont think it works for primitive types).</p>\n<p>#include <iostream></p>\n<p>class X{};\nvoid f(X x, int i) { std::cout &#x3C;&#x3C; “int=” &#x3C;&#x3C; i &#x3C;&#x3C; ‘n’; }\nvoid f(X x, short s) { std::cout &#x3C;&#x3C; “short=” &#x3C;&#x3C; s &#x3C;&#x3C; ‘n’;}\nint main()\n{\nX x1;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">f(x1,1); // calls f(int)\nvoid f(X x, short);\nf(x1,1); // fooled you!</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>}</p>\n<p>Thaks to PK for this !!!</p>\n<p>del.icio.us Tags: <a href=\"http://del.icio.us/sss8ue/software\">software</a> <a href=\"http://del.icio.us/sss8ue/c++\">c++</a> <a href=\"http://del.icio.us/sss8ue/g++\">g++</a> <a href=\"http://del.icio.us/sss8ue/compiler\">compiler</a></p>","frontmatter":{"title":"Constructors vs function declarations...and Koenig lookups","date":"June 12, 2005"}}},"pageContext":{"slug":"/blog/2005-06-12-constructors-vs-function-declarationsand-koenig-lookups/","previous":{"fields":{"slug":"/blog/2005-06-07-lead-generation-and-definition/"},"frontmatter":{"title":"Lead generation and definition"}},"next":{"fields":{"slug":"/blog/2005-06-13-people-in-eda-can-cook/"},"frontmatter":{"title":"People in EDA can cook!!!"}}}},"staticQueryHashes":["2778469899","2841359383","2882394463","3616023293"]}