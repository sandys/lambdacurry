{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2011-10-14-monitoring-hardware-raid-at-a-dedicated-hosting-provider-hivelocity/","result":{"data":{"site":{"siteMetadata":{"title":"Lambdacurry"}},"markdownRemark":{"id":"1b7f8aae-924e-5393-bd76-d1d2d6a77502","excerpt":"Hivelocity has been quite a good host for us for a coupla years now - but today a friend of mine, who owned a 500$ Hivelocity RAID 1+0 server permanently lost…","html":"<p>Hivelocity has been quite a good host for us for a coupla years now - but today a friend of mine, who owned a 500$ Hivelocity RAID 1+0 server permanently lost his data completely, I had to really try and figure out what happened.</p>\n<p>I suddenly figured that I had no scripts to really monitor my hardware raid. After a lot of googling, I came upon a couple of tidbits, that could help others.</p>\n<p><strong>Figuring out what controller you have</strong></p>\n<p>I took a lot of help from this script <a href=\"http://www.watters.ws/scripts/checkraid.sh\">here</a> to figure out which RAID card I have. In general it could be</p>\n<ol>\n<li>3Ware SATA RAID -  lsmod|grep 3w-xxxx or lsmod|grep 3w_xxxx</li>\n<li>LSI Megaraid - lsmod|grep -w megaraid</li>\n<li>LSI Megaraid SAS - lsmod | grep megaraid_sas</li>\n</ol>\n<p>Since, I have a LSI Megaraid card on my server, I will be writing about Megaraid … and its tools - Megacli</p>\n<p><strong>Installing MegaCli</strong></p>\n<p>(This step took me a while to locate) Add the following lines to your <em>/etc/apt/sources.list</em> </p>\n<blockquote>\n<p>deb <a href=\"http://hwraid.le-vert.net/ubuntu\">http://hwraid.le-vert.net/ubuntu</a> lucid main</p>\n</blockquote>\n<p>run <em>sudo apt-get update &#x26;&#x26; sudo apt-get install megacli</em></p>\n<p>MegaCli is now installed. The command I use to get the fastest piece of info is</p>\n<blockquote>\n<p>sudo megacli -AdpAllInfo -aAll -NoLog | grep -A 6 “Virtual Drives”</p>\n</blockquote>\n<p>You get the following pieces of information</p>\n<blockquote>\n<p>Virtual Drives    : 1\nDegraded        : 0\nOffline         : 0\nPhysical Devices  : 3\nDisks           : 2\nCritical Disks  : 0\nFailed Disks    : 0</p>\n</blockquote>\n<p>Thats good enough for a quick monitor - add that into your crontab and you’re good to go. A good readymade script is <a href=\"http://www.watters.ws/scripts/sascheck.sh\">here</a>.</p>\n<p><strong>RAID battery issues</strong></p>\n<p>As I read in this blog <a href=\"http://agiletesting.blogspot.com/2011/09/slow-database-check-raid-battery.html\">post</a>, there are issues with LSI Megaraid controllers (usually in Dell servers), where the RAID battery state is using its heuristics to learn about RAID behavior .. especially after a reboot.</p>\n<p>Generate an <em>event-log-since-last-reboot</em> using <em>megacli -AdpEventLog -GetSinceReboot -f events.log -aALL</em></p>\n<p>Grep for the keyword <em>changing.</em> The reason why this flags is an issue because RAID controllers try to autolearn the battery charge. Double check your autolearn mode by <em>megacli -AdpBbuCmd -GetBbuStatus -a0</em></p>\n<blockquote>\n<p># echo “autoLearnMode=1” > tmp.txt # megacli -AdpBbuCmd -SetBbuProperties -f tmp.txt -a0</p>\n</blockquote>\n<p>Please run the autolearn cycle manually by <em>megacli -AdpBbuCmd -BbuLearn -a0</em></p>","frontmatter":{"title":"Monitoring hardware RAID at a dedicated hosting provider (Hivelocity??) ... and avoiding nasty surprises","date":"October 14, 2011"}}},"pageContext":{"slug":"/blog/2011-10-14-monitoring-hardware-raid-at-a-dedicated-hosting-provider-hivelocity/","previous":{"fields":{"slug":"/blog/2011-08-08-easier-said-than-done-1/"},"frontmatter":{"title":"Easier said than done #1"}},"next":{"fields":{"slug":"/blog/2011-12-02-timestamp-quickies/"},"frontmatter":{"title":"Timestamp quickies"}}}},"staticQueryHashes":["2778469899","2841359383","2882394463","3616023293"]}