{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2013-06-17-effective-way-to-build-production-quality-hadoop-jobs-with-mahout/","result":{"data":{"site":{"siteMetadata":{"title":"Lambdacurry"}},"markdownRemark":{"id":"a51c8579-a9ed-5f8e-8f6c-1962b486de7e","excerpt":"As I  started working on building usable data analytics with hadoop, I saw that there were several query languages out there - Pig and Hive being the primary…","html":"<p>As I  started working on building usable data analytics with hadoop, I saw that there were several query languages out there - Pig and Hive being the primary ones. My primary goal is to define a reasonable framework for experimentation on Hadoop. My primary goal - deriving insights from data. Least important metric - cool new languages. (Which incidentally seems to fit the end conclusion).</p>\n<p>Hive seemed to be the closest fit to the relational model and so serves as a good starting point. A very <a href=\"http://developer.yahoo.com/blogs/hadoop/comparing-pig-latin-sql-constructing-data-processing-pipelines-444.html\">interesting post</a> by Alan Gates @Yahoo made me realize that for most of the tasks out there, the big challenge is to take data and massage it to be usable for big data analysis (for example creating Vectors for Mahout’s recommenders).</p>\n<p>Pig was the next point of experimentation - especially with its ability to work with Jruby UDFs.</p>\n<p><div id=\"gist5795938\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-1-pig\" class=\"file my-2\">\n    \n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-piglatin  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-1-pig-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-1-pig-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">register</span> .<span class=\"pl-k\">/</span><span class=\"pl-smi\">contrib</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">piggybank</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">java</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">piggybank</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">jar</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-1-pig-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">register</span> <span class=\"pl-k\">/</span><span class=\"pl-smi\">home</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">user</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">Code</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hadoop</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hbase</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.94</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">4</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">lib</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">zookeeper</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">3.4</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">5</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">jar</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-1-pig-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">register</span> <span class=\"pl-k\">/</span><span class=\"pl-smi\">home</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">user</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">Code</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hadoop</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hbase</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.94</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">4</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hbase</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.94</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">4</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">jar</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-1-pig-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">register</span> <span class=\"pl-k\">/</span><span class=\"pl-smi\">home</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">user</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">Code</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hadoop</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hbase</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.94</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">4</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">lib</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">guava</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">11.0</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">2</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">jar</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-1-pig-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">register</span> <span class=\"pl-k\">/</span><span class=\"pl-smi\">home</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">user</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">Code</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hadoop</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">hbase</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.94</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">4</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">lib</span><span class=\"pl-k\">/</span><span class=\"pl-smi\">protobuf</span><span class=\"pl-k\">-</span><span class=\"pl-smi\">java</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">2.4</span><span class=\"pl-k\">.</span>0a<span class=\"pl-k\">.</span><span class=\"pl-smi\">jar</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-1-pig-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">register</span> .<span class=\"pl-k\">/</span><span class=\"pl-smi\">udf</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">rb</span> <span class=\"pl-k\">using</span> <span class=\"pl-smi\">jruby</span> <span class=\"pl-k\">as</span> <span class=\"pl-smi\">uuid_udf</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-1-pig-LC7\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-1-pig-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">/*</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-1-pig-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">DEFINE A `access_log_link` CACHE(&#39;hdfs://localhost:54310/user/user/access_log#access_log_link&#39;);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-1-pig-LC10\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-1-pig-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">set mapred.cache.localFiles &#39;hdfs://localhost:54310/user/user/access_log#access_log.1&#39;; </span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-1-pig-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">set mapred.create.symlink yes;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-1-pig-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">*/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-1-pig-LC14\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">/*DEFINE access_log_link CACHE(&#39;hdfs://localhost:54310/user/user/access_log#access_log_link&#39;);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-1-pig-LC15\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">*/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-1-pig-LC16\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">DEFINE</span> <span class=\"pl-smi\">LogLoader</span> <span class=\"pl-smi\">org</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">apache</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">pig</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">piggybank</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">storage</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">apachelog</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">CommonLogLoader</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-1-pig-LC17\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-1-pig-LC18\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">DEFINE</span> <span class=\"pl-smi\">access_log_link2</span> <span class=\"pl-c1\">CACHE</span>(<span class=\"pl-s\">&#39;hdfs://localhost:54310/user/user/access_log#access_log_link&#39;</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-1-pig-LC19\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-1-pig-LC20\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">/*log = LOAD &#39;hdfs://localhost:54310/user/user/access_log&#39; USING LogLoader as (remoteAddr, remoteLogname, user, time, method,uri, proto, status, bytes, referer, userAgent);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-1-pig-LC21\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">*/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-1-pig-LC22\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">log</span> = <span class=\"pl-k\">LOAD</span> <span class=\"pl-s\">&#39;hdfs://localhost:54310/user/user/access_log&#39;</span> <span class=\"pl-k\">USING</span> <span class=\"pl-smi\">LogLoader</span> <span class=\"pl-k\">as</span> (<span class=\"pl-smi\">remoteAddr</span>, <span class=\"pl-smi\">remoteLogname</span>, <span class=\"pl-smi\">user</span>, <span class=\"pl-smi\">time</span>, <span class=\"pl-smi\">method</span>,<span class=\"pl-smi\">uri</span>, <span class=\"pl-smi\">proto</span>, <span class=\"pl-smi\">status</span>, <span class=\"pl-smi\">bytes</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-1-pig-LC23\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">log_id</span> = <span class=\"pl-k\">FOREACH</span> <span class=\"pl-smi\">log</span> <span class=\"pl-k\">GENERATE</span> <span class=\"pl-smi\">uuid_udf</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">uuid</span>(),<span class=\"pl-smi\">remoteAddr</span>, <span class=\"pl-smi\">remoteLogname</span>, <span class=\"pl-smi\">user</span>, <span class=\"pl-smi\">time</span>, <span class=\"pl-smi\">method</span>,<span class=\"pl-smi\">uri</span>, <span class=\"pl-smi\">proto</span>, <span class=\"pl-smi\">status</span>, <span class=\"pl-smi\">bytes</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-1-pig-LC24\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">/*log_id = FOREACH log GENERATE CONCAT(time,CONCAT(remoteAddr, referer)),remoteAddr, remoteLogname, user, time, method,uri, proto, status, bytes;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-1-pig-LC25\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">*/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-1-pig-LC26\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">/*dump log_id;*/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-1-pig-LC27\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-1-pig-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-1-pig-LC28\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">store</span> <span class=\"pl-smi\">log_id</span> <span class=\"pl-k\">into</span> <span class=\"pl-s\">&#39;hbase://access&#39;</span> <span class=\"pl-k\">USING</span> <span class=\"pl-smi\">org</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">apache</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">pig</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">backend</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">hadoop</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">hbase</span><span class=\"pl-k\">.</span><span class=\"pl-c1\">HBaseStorage</span>(<span class=\"pl-s\">&#39;log:remoteAddr log:remoteLogname log:user log:time log:method log:uri log:proto log:status log:bytes&#39;</span>);</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/sandys/5795938/raw/cf6c567d8dd49e775c2297136b0f3adfc5e9027d/1.pig\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/sandys/5795938#file-1-pig\">1.pig</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n<div id=\"gist5795938\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-udf-rb\" class=\"file my-2\">\n    \n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-ruby  \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-udf-rb-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-udf-rb-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-en>require</span> <span class=pl-s>&#39;pigudf&#39;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-udf-rb-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-udf-rb-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-en>require</span> <span class=pl-s>&#39;java&#39;</span>  <span class=pl-c># Magic line for JRuby - Java interworking</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-udf-rb-LC4\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-udf-rb-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-en>import</span> <span class=pl-en>java</span><span class=pl-kos>.</span><span class=pl-en>util</span><span class=pl-kos>.</span><span class=pl-en>UUID</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-udf-rb-LC6\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-udf-rb-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>class</span> <span class=pl-v>JRubyUdf</span> &lt; <span class=pl-v>PigUdf</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-udf-rb-LC8\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-udf-rb-LC9\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-en>outputSchema</span> <span class=pl-s>&quot;uuid:chararray&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-udf-rb-LC10\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-k>def</span> <span class=pl-en>uuid</span><span class=pl-kos>(</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-udf-rb-LC11\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-en>java</span><span class=pl-kos>.</span><span class=pl-en>util</span><span class=pl-kos>.</span><span class=pl-en>UUID</span><span class=pl-kos>.</span><span class=pl-en>randomUUID</span><span class=pl-kos>(</span><span class=pl-kos>)</span><span class=pl-kos>.</span><span class=pl-en>toString</span><span class=pl-kos>(</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-udf-rb-LC12\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-k>end</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-udf-rb-LC13\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-udf-rb-LC14\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-en>outputSchema</span> <span class=pl-s>&quot;type:chararray&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-udf-rb-LC15\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-k>def</span> <span class=pl-en>type</span><span class=pl-kos>(</span><span class=pl-s1>auditRecord</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-udf-rb-LC16\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-udf-rb-LC17\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-kos>(</span><span class=pl-s1>recordPrefix</span><span class=pl-kos>,</span> <span class=pl-s1>recordData</span><span class=pl-kos>)</span> <span class=pl-c1>=</span> <span class=pl-s1>auditRecord</span><span class=pl-kos>.</span><span class=pl-en>split</span><span class=pl-kos>(</span><span class=pl-s>&#39;:&#39;</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-udf-rb-LC18\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-udf-rb-LC19\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c># Generate a hash of all the prefix fields:  node, type and msg</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-udf-rb-LC20\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>prefixFields</span> <span class=pl-c1>=</span> <span class=pl-v>Hash</span><span class=pl-kos>[</span>*<span class=pl-s1>recordPrefix</span><span class=pl-kos>.</span><span class=pl-en>split</span><span class=pl-kos>(</span><span class=pl-s>&#39; &#39;</span><span class=pl-kos>)</span><span class=pl-kos>.</span><span class=pl-en>map</span> <span class=pl-kos>{</span>|<span class=pl-s1>t</span>| <span class=pl-s1>t</span><span class=pl-kos>.</span><span class=pl-en>split</span><span class=pl-kos>(</span><span class=pl-s>&#39;=&#39;</span><span class=pl-kos>)</span><span class=pl-kos>}</span><span class=pl-kos>.</span><span class=pl-en>flatten</span><span class=pl-kos>]</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-udf-rb-LC21\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-udf-rb-LC22\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>prefixFields</span><span class=pl-kos>[</span><span class=pl-s>&#39;type&#39;</span><span class=pl-kos>]</span> <span class=pl-c># return the type</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-udf-rb-LC23\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-udf-rb-LC24\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-k>end</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-udf-rb-LC25\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-udf-rb-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-udf-rb-LC26\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>end</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/sandys/5795938/raw/cf6c567d8dd49e775c2297136b0f3adfc5e9027d/udf.rb\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/sandys/5795938#file-udf-rb\">udf.rb</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>This runs fine… on your laptop. However, the pig problem happens when you are actually preparing to run this job on a cluster. At that time all the hidden things start to hit you - JARs not being in classpath, JARs not being in the <a href=\"http://hadoop.apache.org/docs/r1.0.4/api/org/apache/hadoop/filecache/DistributedCache.html\">distributed cache</a> and things start to add up to be a pain. These start impacting you more and more if you are combining more than one toolkit - for example Hadoop + HBase + Mahout.</p>\n<p>That said, one of the very interesting points of integration that I stumbled upon was embedding Pig <em><strong>inside</strong></em> Python (using Java) or Javascript. (BTW, a lot of this comes via <a href=\"http://hortonworks.com/blog/new-apache-pig-features-part-2-embedding/\">Hortonworks</a>, which is doing interesting things around Hadoop and Pig). That seemed to me as very interesting, however if you notice there is a very quirky piece of code in there :</p>\n<blockquote>\n<p>P = Pig.compile(\"\"\"register udf.jar\nDEFINE find_centroid FindCentroid(‘$centroids’);</p>\n</blockquote>\n<p>Essentially, you could write a UDF in Python, then call Pig through Python. The Pig script then calls the UDF. All of this finally gets compiled on-the-fly into a Jar (cos, that’s what Pig does) and sent to Hadoop. <strong>This</strong> was essentially the step that convinced me that this tooling was unnecessary complex and there ought to be a simpler way.</p>\n<p>I realized that Pig and Hive are actually step two in the whole implementation process of mapreduce and Hadoop.</p>\n<p>Step one has got to be writing your own custom jobs in Java or Scala and creating <em>standalone</em> job JARs.</p>\n<p>Yes, this is suboptimal since you end up with large sized jars (a simple job JAR with hadoop and mahout ended up being 32MB). Remember that these JARs will be populated to your cluster (and hopefully persisted in the distributed cache for subsequent runs), but when beginning you dont really need to worry about optimization. Secondly, at a later stage you could still this very workflow to create a non-standalone JAR and instead push the dependent libs out by using either</p>\n<ul>\n<li>the <strong><em>-Dmapred.cache.files</em></strong> variable to force distributed caching of libraries</li>\n<li> use the handy <em><strong>-libjars</strong></em> variable.</li>\n<li>or use <strong>HADOOP_CLASSPATH</strong> environment variable.</li>\n</ul>\n<p>My Scala code <a href=\"https://github.com/sandys/distributed-scala-mahout\">here</a> is a simple Mahout vector creation algorithm (based on sample data from <a href=\"http://www.cs.toronto.edu/~tsap/experiments/datasets/index.html\">here</a> ) and creates a standalone JAR (using <strong><em>sbt</em> assembly</strong>)</p>","frontmatter":{"title":"Effective way to build production quality hadoop jobs (with mahout)","date":"June 17, 2013"}}},"pageContext":{"slug":"/blog/2013-06-17-effective-way-to-build-production-quality-hadoop-jobs-with-mahout/","previous":{"fields":{"slug":"/blog/2013-05-25-configuring-the-tplink-mr3020-with-dd-wrt-and-the-single-port-problem/"},"frontmatter":{"title":"Configuring the TP-Link travel router with DD-WRT (and solving the single port problem)"}},"next":{"fields":{"slug":"/blog/2013-06-17-complexity-of-clicking-on-a-map-real-estate-based-map-uxes-in-india/"},"frontmatter":{"title":"Complexity of clicking on a map - real estate based map UXes in India"}}}},"staticQueryHashes":["2778469899","2841359383","2882394463","3616023293"]}